(self.webpackChunk=self.webpackChunk||[]).push([[511],{623:(e,n,t)=>{"use strict";t.d(n,{Z:()=>a});var s=t(4015),o=t.n(s),r=t(3645),i=t.n(r)()(o());i.push([e.id,".collapse{border-bottom:1px solid #ededed}","",{version:3,sources:["webpack://./resources/js/Pages/Admin/Course/Form.vue"],names:[],mappings:"AAwOA,UACE,+BAtOF",sourcesContent:['\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n@import "../../../../sass/variables";\n\n.collapse {\n  border-bottom: 1px solid $grey-lightest;\n}\n'],sourceRoot:""}]);const a=i},1511:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>h});var s=t(2971),o=t(1795);const r={props:["course_id"],data:function(){return{isLoaded:!1,isSaving:!1,errorLoading:!1,newUsers:[],errors:"",enrolledUsers:[],users:[],filteredUsers:this.users}},mounted:function(){var e=this;axios({method:"get",url:"/course/".concat(this.course_id,"/users"),timeout:15e3}).then((function(n){e.enrolledUsers=n.data,e.isLoaded=!0})).catch((function(n){e.errorLoading=!0,axios.post("/log",{error:"COURSE ENROLLED USERS GET ERROR, ".concat(o.description,", ").concat(JSON.stringify(n))})})),axios({method:"get",url:"/users"}).then((function(n){e.users=n.data})).catch((function(n){e.errorLoading=!0,axios.post("/log",{error:"COURSE USERS GET ERROR, ".concat(o.description,", ").concat(JSON.stringify(n))})}))},watch:{isLoaded:function(){}},methods:{getFilteredUsers:function(e){this.filteredUsers=this.users.filter((function(n){return(n.first_name+" "+n.last_name).toString().toLowerCase().indexOf(e.toLowerCase())>=0||n.email.toString().toLowerCase().indexOf(e.toLowerCase())>=0}))},enrollSelected:function(){var e=this;axios({method:"post",url:"/course/".concat(this.course_id,"/enroll"),data:this.newUsers.map((function(e){return e.id})),timeout:9e4}).then((function(n){e.enrolledUsers=e.enrolledUsers.concat(e.newUsers),e.newUsers=[]})).catch((function(n){e.isSaving=!1,e.displayErrorNotification(n.response.data.message),axios.post("/log",{error:"COURSE USER ENROLMENT ERROR\n".concat(o.description,"\n").concat(n.name,": ").concat(n.message,"\nReply data: ").concat(JSON.stringify(data),"\n\n")}),e.errors=n.response.data.errors||""}))},onUnenroll:function(e){var n=this;axios({method:"get",url:"/course/".concat(this.course_id,"/unenroll/user/").concat(e)}).then((function(t){setTimeout((function(){n.isSaving=!1}),2e3),console.log("User removed"),n.enrolledUsers=n.enrolledUsers.filter((function(n){return n.id!=e}))})).catch((function(e){n.isSaving=!1,n.displayErrorNotification(e.response.data.message),axios.post("/log",{error:"COURSE USER DELETE ERROR\n".concat(o.description,"\n").concat(e.name,": ").concat(e.message,"\nReply data: ").concat(JSON.stringify(data),"\n\n")}),n.errors=e.response.data.errors||""}))},displayErrorNotification:function(e){this.$buefy.snackbar.open({message:"<b>Error:</b> ".concat(e),type:"is-danger",position:"is-bottom",duration:5e3})}}};var i=t(1900);const a=(0,i.Z)(r,(function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"user-list"},[e.errorLoading?t("div",{staticClass:"notification is-danger"},[e._v("\n    An error occured while trying to load users\n  ")]):e.isLoaded?t("div",[e.users?t("b-field",{staticClass:"mt-4 mb-4"},[t("b-taginput",{attrs:{"open-on-focus":!0,data:e.filteredUsers,ellipsis:"",expanded:"",autocomplete:"","allow-new":!1,placeholder:"Add a person",field:"first_name"},on:{typing:e.getFilteredUsers},scopedSlots:e._u([{key:"default",fn:function(n){return[t("div",[e._v(e._s(n.option.first_name)+" "+e._s(n.option.last_name))]),e._v(" "),t("div",{staticClass:"is-size-7"},[e._v(e._s(n.option.email))])]}}],null,!1,3123260134),model:{value:e.newUsers,callback:function(n){e.newUsers=n},expression:"newUsers"}}),e._v(" "),t("p",{staticClass:"control"},[t("b-button",{on:{click:e.enrollSelected}},[e._v("Save")])],1)],1):e._e(),e._v(" "),e._l(e.enrolledUsers,(function(n){return t("div",{key:n.id,staticClass:"panel-block is-justify-between mb-4"},[t("div",[t("p",[e._v(e._s(n.first_name)+" "+e._s(n.last_name))]),e._v(" "),t("p",{staticClass:"is-size-7"},[e._v(e._s(n.email))])]),e._v(" "),t("button",{staticClass:"button is-small",on:{click:function(t){return e.onUnenroll(n.id)}}},[e._v("Unenroll")])])}))],2):t("b-loading",{attrs:{"is-full-page":!1,active:!e.isLoaded}})],1)}),[],!1,null,null,null).exports;function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,s)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){u(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function u(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const d={props:["errors","data"],components:{TipTap:s.Z,CourseUsers:a},data:function(){var e,n,t,s,o,r,i,a,l,c,u,d;return{form:this.$inertia.form({id:null!==(e=null===(n=this.data)||void 0===n?void 0:n.id)&&void 0!==e?e:null,title:null!==(t=null===(s=this.data)||void 0===s?void 0:s.title)&&void 0!==t?t:null,description:null!==(o=null===(r=this.data)||void 0===r?void 0:r.description)&&void 0!==o?o:null,archived:null!==(i=null===(a=this.data)||void 0===a?void 0:a.archived)&&void 0!==i&&i,is_open:null!==(l=null===(c=this.data)||void 0===c?void 0:c.is_open)&&void 0!==l&&l,live:null===(u=null===(d=this.data)||void 0===d?void 0:d.live)||void 0===u||u}),destroyWeekForm:this.$inertia.form(),destroyLessonForm:this.$inertia.form(),isOpen:null}},mounted:function(){},methods:{confirmLessonDelete:function(e,n){var t=this;this.$buefy.dialog.confirm({type:"is-danger",hasIcon:!0,title:"Confirm lesson deletion",message:"<strong>Are you sure you want to delete this lesson?</strong>",onConfirm:function(){return t.destroyLessonForm.transform((function(e){return{_method:"DELETE"}})).post(route("lesson.delete",{week:e,lesson:n,course:t.$page.props.parameters.course}),{preserveScroll:!0,onSuccess:function(){t.successToast("Week deleted")},onError:function(e){t.errorToast("Could not delete week.")}})}})},confirmWeekDelete:function(e){var n=this;this.$buefy.dialog.confirm({title:"Confirm week deletion",type:"is-danger",hasIcon:!0,message:"Are you sure you want to delete this week?<br> <strong>This will also delete any lessons within this week.</strong>",onConfirm:function(){return n.destroyWeekForm.delete(route("week.delete",{week:e,course:n.$page.props.parameters.course}),{preserveScroll:!0,onSuccess:function(){n.successToast("Week deleted")},onError:function(e){n.errorToast("Could not delete week.")}})}})},onSubmit:function(){var e=this,n=this.data?route("course.update",{course:this.$page.props.parameters.course}):route("course.create");this.form.transform((function(n){return c(c({},n),{},{course_id:e.$page.props.parameters.course,_method:e.data?"PUT":"POST"})})).post(n,{preserveScroll:!0,onSuccess:function(){e.successToast("Course saved")},onError:function(n){e.errorToast("Check the form for errors")}})}}};var p=t(3379),m=t.n(p),f=t(623),v={insert:"head",singleton:!1};m()(f.Z,v);f.Z.locals;const h=(0,i.Z)(d,(function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("app-layout",[t("div",{staticClass:"columns is-centered"},[t("div",{staticClass:"column is-7-tablet is-6-desktop is-5-widescreen"},[t("inertia-link",{staticClass:"back-link has-text-dark",attrs:{href:e.route("courses.manage")}},[e._v("← Back to admin")]),e._v(" "),t("div",{staticClass:"box"},[t("h3",{staticClass:"title has-text-centered"},[e._v(e._s(e.data?"Modifica":"Creare")+" corso "),t("span",{staticClass:"emoji"},[e._v("✏️")])]),e._v(" "),t("p",{staticClass:"subtitle has-text-centered"},[e._v(e._s(e.data?"Edit the":"Set up a new")+" course below")]),e._v(" "),e.errors.course?t("b-notification",{attrs:{type:"is-danger","has-icon":"",role:"alert",closable:!1,message:e.errors.course[0]}}):e._e(),e._v(" "),t("b-tabs",[t("b-tab-item",{attrs:{label:"Overview"}},[t("b-field",{attrs:{label:"Title",message:e.errors.title,type:e.errors.title?"is-danger":null}},[t("b-input",{attrs:{required:"",name:"title",placeholder:"Enter the title for this course"},model:{value:e.form.title,callback:function(n){e.$set(e.form,"title",n)},expression:"form.title"}})],1),e._v(" "),t("b-field",{attrs:{label:"Description",message:e.errors.description,type:e.errors.description?"is-danger":null}},[t("tip-tap",{model:{value:e.form.description,callback:function(n){e.$set(e.form,"description",n)},expression:"form.description"}})],1),e._v(" "),e.data?t("b-checkbox",{model:{value:e.form.archived,callback:function(n){e.$set(e.form,"archived",n)},expression:"form.archived"}},[e._v("Archive this course?")]):e._e(),t("br"),e._v(" "),t("b-checkbox",{model:{value:e.form.live,callback:function(n){e.$set(e.form,"live",n)},expression:"form.live"}},[e._v("Make this course live?")]),t("br"),e._v(" "),t("b-checkbox",{model:{value:e.form.is_open,callback:function(n){e.$set(e.form,"is_open",n)},expression:"form.is_open"}},[e._v("Make this course open to all?")])],1),e._v(" "),t("b-tab-item",{attrs:{label:"Lessons"}},[t("div",{staticClass:"is-flex is-justify-content-space-between is-align-items-center mb-2"},[t("h3",{staticClass:"label"},[e._v("Lessons")]),e._v(" "),e.$page.props.parameters.course?t("inertia-link",{staticClass:"button is-primary is-small",attrs:{href:e.route("week.create",{course:e.$page.props.parameters.course})}},[e._v("\n                Add a new week")]):e._e()],1),e._v(" "),e.$page.props.parameters.course?t("nav",{staticClass:"mb-6"},[e._l(e.data.weeks,(function(n,s){return t("b-collapse",{key:s,staticClass:"collapse",attrs:{animation:"slide",open:e.isOpen==s},on:{open:function(n){e.isOpen=s}},scopedSlots:e._u([{key:"trigger",fn:function(s){return[t("div",{staticClass:"is-radius is-size-6 p-2 pl-2 is-align-items-center is-flex",class:s.open?"has-background-success":"",attrs:{role:"button"}},[t("b-icon",{staticClass:"mr-2",attrs:{icon:s.open?"menu-down":"menu-right"}}),e._v(" "),t("span",{staticClass:"text-overflow-ellipsis mr-2"},[e._v(e._s(n.name))]),e._v(" "),t("span",{staticClass:"is-size-7 ml-2 mr-2 has-text-weight-normal"},[e._v("\n                        "+e._s(n.lessons.length||"No")+" lessons\n                      ")]),e._v(" "),t("div",{staticClass:"ml-a has-text-weight-normal"},[t("inertia-link",{staticClass:"button is-small is-link is-outlined",attrs:{href:e.route("lesson.create",{course:e.$page.props.parameters.course,week:n.number})},on:{click:function(e){e.stopPropagation()}}},[e._v("Add lesson")]),e._v(" "),t("b-dropdown",{attrs:{position:"is-bottom-left","append-to-body":"","aria-role":"menu"},nativeOn:{click:function(e){e.stopPropagation()}},scopedSlots:e._u([{key:"trigger",fn:function(){return[t("b-button",{staticClass:"is-small"},[t("b-icon",{attrs:{icon:"cog",size:"is-small"}})],1)]},proxy:!0}],null,!0)},[e._v(" "),t("b-dropdown-item",{attrs:{"has-link":"","aria-role":"menuitem"}},[t("inertia-link",{attrs:{href:e.route("week.edit",{course:e.$page.props.parameters.course,week:n.number})},on:{click:function(e){e.stopPropagation()}}},[e._v("Edit")])],1),e._v(" "),t("b-dropdown-item",{attrs:{"has-link":"","aria-role":"menuitem"}},[t("a",{attrs:{href:"#",role:"button"},on:{click:function(t){return t.stopPropagation(),e.confirmWeekDelete(n.number)}}},[e._v("Delete")])])],1)],1)],1)]}}],null,!0)},[e._v(" "),n.lessons.length?e._e():t("div",{staticClass:"notification has-background-white mb-0 is-size-7 has-text-centered"},[e._v("\n                    No lessons in this week. "),t("inertia-link",{attrs:{href:e.route("lesson.create",{course:e.$page.props.parameters.course,week:n.number})}},[e._v("Add the first")]),e._v(".\n                  ")],1),e._v(" "),e._l(n.lessons,(function(s){return t("div",{key:s.id,staticClass:"panel-block pl-6 has-background-white-bis is-justify-between"},[t("span",{staticClass:"text-overflow-ellipsis is-size-6"},[e._v(e._s(s.title))]),e._v(" "),t("div",{staticClass:"is-size-6 ml-2"},[t("inertia-link",{staticClass:"button has-text-grey is-small",attrs:{href:e.route("lesson.edit",{course:e.$page.props.parameters.course,week:n.number,lesson:s.id})}},[e._v("Edit")]),e._v(" "),t("button",{staticClass:"button has-text-grey is-small",on:{click:function(t){return e.confirmLessonDelete(n.number,s.id)}}},[e._v("Delete")])],1)])}))],2)})),e._v(" "),e.data.weeks?e._e():t("section",{staticClass:"section is-medium has-background-light has-text-centered"},[e._v("\n                Start by "),t("inertia-link",{attrs:{href:e.route("week.create",{course:e.$page.props.parameters.course})}},[e._v("adding a week")]),e._v(". Once you’ve added a week, you can then add lessons to it.\n              ")],1)],2):t("div",{staticClass:"notification is-size-7"},[e._v("\n              Save this course before adding lessons.\n            ")])]),e._v(" "),e.$page.props.parameters.course?t("b-tab-item",{attrs:{label:"Students"}},[t("course-users",{attrs:{course_id:e.$page.props.parameters.course}}),e._v(" "),t("div",{staticClass:"notification has-background-light"},[t("h3",[e._v("Invite people")]),e._v(" "),t("p",{staticClass:"is-size-7"},[e._v("Share the link below with people to invite them to this course. If they don’t already have an account they'll be prompted to create one.")]),e._v(" "),t("input",{staticClass:"input is-small",attrs:{id:"course-invite-link",type:"text"},domProps:{value:e.route("course.enrollCurrentUser",{course:e.data.hash})}})])],1):e._e()],1),e._v(" "),t("hr"),e._v(" "),t("b-button",{attrs:{type:"is-primary",disabled:!e.form.title,loading:e.form.processing,expanded:""},on:{click:function(n){return n.preventDefault(),e.onSubmit(n)}}},[e._v(e._s(e.data?"Update":"Create"))])],1)],1)])])}),[],!1,null,null,null).exports}}]);
//# sourceMappingURL=511.88433b6abc220a7093c6.js.map