(self.webpackChunk=self.webpackChunk||[]).push([[24],{9024:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>p});var r=o(2971),s=o(1795);const n={props:["cohort_id"],data:function(){return{isLoaded:!1,isSaving:!1,errorLoading:!1,newUsers:[],errors:"",enrolledUsers:[],users:[],filteredUsers:this.users}},mounted:function(){var e=this;axios({method:"get",url:route("cohort.users",{cohort:this.cohort_id}),timeout:15e3}).then((function(t){e.enrolledUsers=t.data,e.isLoaded=!0})).catch((function(t){e.errorLoading=!0,axios.post("/log",{error:"COHORT ENROLLED USERS GET ERROR, ".concat(s.description,", ").concat(JSON.stringify(t))})})),axios({method:"get",url:"/users"}).then((function(t){e.users=t.data})).catch((function(t){e.errorLoading=!0,axios.post("/log",{error:"COHORT USERS GET ERROR, ".concat(s.description,", ").concat(JSON.stringify(t))})}))},watch:{isLoaded:function(){}},methods:{getFilteredUsers:function(e){this.filteredUsers=this.users.filter((function(t){return(t.first_name+" "+t.last_name).toString().toLowerCase().indexOf(e.toLowerCase())>=0||t.email.toString().toLowerCase().indexOf(e.toLowerCase())>=0}))},enrollSelected:function(){var e=this;axios({method:"post",url:route("cohort.enroll",{cohort:this.cohort_id}),data:this.newUsers.map((function(e){return e.id})),timeout:9e4}).then((function(t){e.enrolledUsers=e.enrolledUsers.concat(e.newUsers),e.newUsers=[]})).catch((function(t){e.isSaving=!1,e.displayErrorNotification(t.response.data.message),axios.post("/log",{error:"COHORT USER ENROLMENT ERROR\n".concat(s.description,"\n").concat(t.name,": ").concat(t.message,"\nReply data: ").concat(JSON.stringify(data),"\n\n")}),e.errors=t.response.data.errors||""}))},onUnenroll:function(e){var t=this;axios({method:"get",url:route("cohort.unenroll",{cohort:this.cohort_id,user:e})}).then((function(o){setTimeout((function(){t.isSaving=!1}),2e3),t.enrolledUsers=t.enrolledUsers.filter((function(t){return t.id!=e}))})).catch((function(e){t.isSaving=!1,t.displayErrorNotification(e.response.data.message),axios.post("/log",{error:"COHORT USER DELETE ERROR\n".concat(s.description,"\n").concat(e.name,": ").concat(e.message,"\nReply data: ").concat(JSON.stringify(data),"\n\n")}),t.errors=e.response.data.errors||""}))},displayErrorNotification:function(e){this.$buefy.snackbar.open({message:"<b>Error:</b> ".concat(e),type:"is-danger",position:"is-bottom",duration:5e3})}}};var a=o(1900);const i=(0,a.Z)(n,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"user-list"},[e.errorLoading?o("div",{staticClass:"notification is-danger"},[e._v("\n    An error occured while trying to load users\n  ")]):e.isLoaded?o("div",[e.users?o("b-field",{staticClass:"mt-4 mb-4"},[o("b-taginput",{attrs:{"open-on-focus":!0,data:e.filteredUsers,ellipsis:"",expanded:"",autocomplete:"","allow-new":!1,placeholder:"Add a person",field:"first_name"},on:{typing:e.getFilteredUsers},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",[e._v("\n            "+e._s(t.option.first_name)+" "+e._s(t.option.last_name)+"\n          ")]),e._v(" "),o("div",{staticClass:"is-size-7"},[e._v(e._s(t.option.email))])]}}],null,!1,3669610502),model:{value:e.newUsers,callback:function(t){e.newUsers=t},expression:"newUsers"}}),e._v(" "),o("p",{staticClass:"control"},[o("b-button",{on:{click:e.enrollSelected}},[e._v("Save")])],1)],1):e._e(),e._v(" "),e._l(e.enrolledUsers,(function(t){return o("div",{key:t.id,staticClass:"panel-block is-justify-between mb-4"},[o("div",[o("p",[e._v(e._s(t.first_name)+" "+e._s(t.last_name))]),e._v(" "),o("p",{staticClass:"is-size-7"},[e._v(e._s(t.email))])]),e._v(" "),o("button",{staticClass:"button is-small",on:{click:function(o){return e.onUnenroll(t.id)}}},[e._v("\n        Unenroll\n      ")])])}))],2):o("b-loading",{attrs:{"is-full-page":!1,active:!e.isLoaded}})],1)}),[],!1,null,null,null).exports;function c(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function l(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?c(Object(o),!0).forEach((function(t){u(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):c(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function u(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const d={props:["errors","data"],components:{TipTap:r.Z,CourseUsers:i},data:function(){var e,t,o,r,s,n,a,i,c,l;return{form:this.$inertia.form({id:null!==(e=null===(t=this.data)||void 0===t?void 0:t.id)&&void 0!==e?e:null,title:null!==(o=null===(r=this.data)||void 0===r?void 0:r.title)&&void 0!==o?o:null,enable_chatroom:null!==(s=null===(n=this.data)||void 0===n?void 0:n.enable_chatroom)&&void 0!==s&&s,active:null===(a=null===(i=this.data)||void 0===i?void 0:i.active)||void 0===a||a,companion:null!==(c=null===(l=this.data)||void 0===l?void 0:l.companion)&&void 0!==c&&c})}},mounted:function(){},methods:{onSubmit:function(){var e=this,t=this.data?route("cohort.update",{course:this.$page.props.parameters.course,cohort:this.$page.props.parameters.cohort}):route("cohort.store",{course:this.$page.props.parameters.course});this.form.transform((function(t){return l(l({},t),{},{_method:e.data?"PUT":"POST"})})).post(t,{preserveScroll:!0,onSuccess:function(){e.successToast("Class saved")},onError:function(t){e.errorToast("Check the form for errors")}})}}};const p=(0,a.Z)(d,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("app-layout",[o("div",{staticClass:"columns is-centered"},[o("div",{staticClass:"column is-7-tablet is-6-desktop is-5-widescreen"},[o("inertia-link",{staticClass:"back-link has-text-dark",attrs:{href:e.route("course.edit",{course:e.$page.props.parameters.course})}},[e._v("← Back to course")]),e._v(" "),o("div",{staticClass:"box"},[o("h3",{staticClass:"title has-text-centered"},[e._v("\n          "+e._s(e.data?"Modifica":"Creare")+" classi\n          "),o("span",{staticClass:"emoji"},[e._v("✏️")])]),e._v(" "),o("p",{staticClass:"subtitle has-text-centered"},[e._v("\n          "+e._s(e.data?"Edit the":"Set up a new")+" class below\n        ")]),e._v(" "),e.errors.course?o("b-notification",{attrs:{type:"is-danger","has-icon":"",role:"alert",closable:!1,message:e.errors.course[0]}}):e._e(),e._v(" "),o("b-tabs",[o("b-tab-item",{attrs:{label:"Overview"}},[o("b-field",{attrs:{label:"Title",message:e.errors.title,type:e.errors.title?"is-danger":null}},[o("b-input",{attrs:{required:"",name:"title",placeholder:"Enter the name for this class"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),e._v(" "),o("b-checkbox",{model:{value:e.form.enable_chatroom,callback:function(t){e.$set(e.form,"enable_chatroom",t)},expression:"form.enable_chatroom"}},[e._v("Allow students to post in chatroom?")]),e._v(" "),o("b-checkbox",{model:{value:e.form.companion,callback:function(t){e.$set(e.form,"companion",t)},expression:"form.companion"}},[e._v("Companion course?")]),e._v(" "),o("b-checkbox",{model:{value:e.form.active,callback:function(t){e.$set(e.form,"active",t)},expression:"form.active"}},[e._v("Active?")])],1),e._v(" "),e.$page.props.parameters.cohort?o("b-tab-item",{attrs:{label:"Students"}},[o("course-users",{attrs:{cohort_id:e.$page.props.parameters.cohort}}),e._v(" "),o("div",{staticClass:"notification has-background-light"},[o("h3",[e._v("Invite people")]),e._v(" "),o("p",{staticClass:"is-size-7"},[e._v("\n                Share the link below with people to invite them to this class.\n                If they don’t already have an account they'll be prompted to\n                create one.\n              ")]),e._v(" "),o("input",{staticClass:"input is-small",attrs:{id:"course-invite-link",type:"text"},domProps:{value:e.route("cohort.enrollCurrentUser",{cohort:e.data.hash})}})])],1):e._e()],1),e._v(" "),o("hr"),e._v(" "),o("b-button",{attrs:{type:"is-primary",disabled:!e.form.title,loading:e.form.processing,expanded:""},on:{click:function(t){return t.preventDefault(),e.onSubmit(t)}}},[e._v(e._s(e.data?"Update":"Create"))])],1)],1)])])}),[],!1,null,null,null).exports}}]);
//# sourceMappingURL=24.6119a69282722112be81.js.map